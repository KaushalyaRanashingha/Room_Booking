<!DOCTYPE html>
<html>
<head>
  <title>Bookings</title>
  <!-- Bootstrap CSS -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  >
  <!-- Your small overrides -->
  <link rel="stylesheet" href="/admin.css">
</head>
<body class="bg-light">
  <div class="d-flex min-vh-100">
    <%- include("sidebar") %>

    <div class="flex-grow-1 d-flex flex-column">
      <%- include("navbar") %>

      <main class="container-fluid py-3">
        <!-- Page header -->
        <div class="d-flex flex-wrap justify-content-between align-items-end mb-3">
          <div>
            <h1 class="h3 mb-1">Bookings</h1>
            <p class="text-muted mb-0">
              View and review all room bookings.
            </p>
          </div>
          <span class="badge bg-light text-muted border">
            Total bookings: <%= bookings.length %>
          </span>
        </div>

        <!-- Bookings table -->
        <section class="card shadow-sm">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <h2 class="h5 mb-0">All bookings</h2>
              <small class="text-muted">
                Showing <%= bookings.length %> record(s)
              </small>
            </div>

            <div class="table-responsive">
              <table class="table table-hover align-middle border shadow-sm">
                <thead class="table-light">
                  <tr>
                    <th>Guest info</th>
                    <th>Room Details</th>
                    <th>Stay Dates</th>
                    <th>Status</th>
                    <th class="text-end">Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <% if (bookings.length === 0) { %>
                    <tr><td colspan="5" class="text-center py-4 text-muted">No bookings found.</td></tr>
                  <% } %>

                  <% bookings.forEach(b => { %>
                    <tr>
                      <td>
                        <div class="fw-bold"><%= b.name %></div>
                        <div class="small text-muted"><%= b.email %></div>
                        <div class="small text-muted"><%= b.mobile %></div>
                      </td>

                      <td>
                        <div class="badge bg-light text-dark border mb-1">
                          <%= b.room?.roomNumber ? 'Room ' + b.room.roomNumber : 'Room N/A' %>
                        </div>
                        <div class="small text-muted"><%= b.room?.type %></div>
                        <div class="small fw-bold">LKR <%= b.room?.price %></div>
                      </td>

                      <td class="small">
                        <div class="text-success"><strong>In:</strong> <%= b.checkin.toDateString() %></div>
                        <div class="text-danger"><strong>Out:</strong> <%= b.checkout.toDateString() %></div>
                      </td>

                      <td>
                        <span class="badge rounded-pill bg-<%= b.status === 'Approved' ? 'success' : (b.status === 'Rejected' ? 'danger' : 'warning') %>">
                          <%= b.status %>
                        </span>
                      </td>

                      <td class="text-end">
                        <% if (b.status === 'Pending') { %>
                          <div class="btn-group">
                            <a href="/api/admin/booking/approve/<%= b._id %>" class="btn btn-sm btn-success">
                              Approve
                            </a>
                            <a href="/api/admin/booking/reject/<%= b._id %>" class="btn btn-sm btn-outline-danger ms-1">
                              Reject
                            </a>
                          </div>
                        <% } else { %>
                          <span class="text-muted small italic">Processed</span>
                        <% } %>
                      </td>
                    </tr>
                  <% }) %>
                </tbody>
              </table>
            </div>
          </div>
        </section>
      </main>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>